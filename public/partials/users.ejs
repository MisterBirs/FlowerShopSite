<table class="table">
  <thead class="thead-light">
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Username</th>
      <th scope="col">Password</th>
      <th scope="col">Role</th>
      <th scope="col">branch</th>
      <th scope="col">Manage</th>
    </tr>
  </thead>
  <tbody>
    <%users.forEach(function(user){%>
    <tr>
      <th scope="row">
        <%=user.id%>
      </th>
      <td>
        <%=user.name%>
      </td>
      <td>
        <%=user.password%>
      </td>
      <td>
        <%=user.position%>
      </td>
      <%if(user.numberBranch){%>
      <td>
        <%=user.numberBranch%>
      </td>
      <%}else{%>
      <td></td>
      <% } %>
      <%if(position==='manager'){%>
      <td>
        <button onclick="updateUser('<%=user.name%>')" class="btn btn-primary m-2">Update</button>
        <button onclick="deleteUser('<%=user.name%>')" class="btn btn-danger m-2">Delete</button>
      </td>
      <%}else{%>
      <td></td>
      <%}%>
    </tr>
    <%})%>
  </tbody>
</table>
<button class="btn btn-primary" onclick="addUser()">Add user</button>
<script>
  function updateUser(username) {
    $('#body').load(`./updateForm?username=${this_username}&userToUpdate=${username}`);
  }

  function addUser() {
    console.log('clicked' + this_username);
    $('#body').load(`./addUser?username=${this_username}`);
  }

  function deleteUser(username) {
    fetch(`/deleteUser?username=${this_username}&userToDelete=${username}`, {
      method: 'DELETE'
    }).then(res => {
      if (res.status === 200)
        alert(`${username} deleted successfully`);
    })
    $('#body').load(`./users?username=${this_username}`);
  }
</script>